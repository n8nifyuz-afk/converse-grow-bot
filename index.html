<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChatLearn - AI Chat Platform</title>
    <meta name="description" content="ChatLearn - Your intelligent AI chat platform for seamless conversations" />
    <meta name="author" content="ChatLearn" />
    <link rel="canonical" href="https://www.chatl.ai/" />
    <!-- Cookiebot -->
    <script
      id="Cookiebot"
      src="https://consent.cookiebot.com/uc.js"
      data-cbid="cc9cba1a-5783-4a8d-ba42-f4f1961b15a4"
      data-blockingmode="auto"
      type="text/javascript"
    ></script>

    <!-- Google Consent Mode -->
    <script>
      window.dataLayer = window.dataLayer || [];
      window.gtag = function () { dataLayer.push(arguments); };

      gtag('consent', 'default', {
        'analytics_storage': 'denied',
        'ad_user_data': 'denied',
        'ad_storage': 'denied',
        'ad_personalization': 'denied',
        'functionality_storage': 'denied',
        'personalization_storage': 'denied',
        'security_storage': 'granted',
        'wait_for_update': 500
      });

      gtag('set', 'ads_data_redaction', true);
      gtag('set', 'url_passthrough', true);
      gtag('set', 'allow_ad_personalization_signals', false);

      gtag('js', new Date());
    </script>
  </head>

  <body>
    <div id="root"></div>

    <!-- React app -->
    <script type="module" src="/src/main.tsx"></script>

    <!-- Tracking scripts (GTM + GA4) -->
    <script>
      (function() {
        var trackingLoaded = false;

        function loadTrackingOnce() {
          if (trackingLoaded) return;
          trackingLoaded = true;

          // Google Tag Manager
          (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),
                dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-NMLGMTL5');

          // Google Analytics / Ads
          var gtagScript = document.createElement('script');
          gtagScript.async = true;
          gtagScript.src = 'https://www.googletagmanager.com/gtag/js?id=AW-16917874636';

          gtagScript.onload = function() {
            window.gtag('config', 'AW-16917874636');
            window.gtag('config', 'G-EDSR82W70J');
          };

          document.head.appendChild(gtagScript);
        }

        function cookiebotHasConsent() {
          try {
            // Cookiebot.consent statistik yoki marketing uchun rozilikni tekshiradi
            return !!(window.Cookiebot && window.Cookiebot.consent && (window.Cookiebot.consent.statistics || window.Cookiebot.consent.marketing));
          } catch (e) {
            return false;
          }
        }

        function waitForConsentThenLoad() {
          if (cookiebotHasConsent()) {
            loadTrackingOnce();
            return;
          }

          var waited = 0;
          var interval = setInterval(function() {
            if (cookiebotHasConsent()) {
              clearInterval(interval);
              loadTrackingOnce();
            } else {
              waited += 500;
              if (waited > 20000) { // 20s timeout
                clearInterval(interval);
              }
            }
          }, 500);
        }

        // DARHOL consent-ni kutib yuklashni boshlaymiz (DOMContentLoaded ga bog'liq emas)
        waitForConsentThenLoad();

        // Qo'shimcha: agar Cookiebot onAccept eventi mavjud bo'lsa, unga ham moslashamiz
        if (window.addEventListener) {
          window.addEventListener('CookiebotOnAccept', function(){
            waitForConsentThenLoad();
          }, false);

          // ba'zi implementatsiyalarda: Cookiebot.consentUpdated kabi event bo'lishi mumkin
          window.addEventListener('CookiebotOnConsentChanged', function(){
            waitForConsentThenLoad();
          }, false);
        }

      })();
    </script>
  </body>
</html>
