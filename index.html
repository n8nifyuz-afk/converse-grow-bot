<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
    />
    <title>ChatLearn - AI Chat Platform</title>
    <meta name="description" content="ChatLearn - Your intelligent AI chat platform for seamless conversations" />
    <meta name="author" content="ChatLearn" />
    <link rel="canonical" href="https://www.chatl.ai/" />
    <link rel="icon" href="https://www.chatl.ai/favicon.png" type="image/png" />
    <link rel="apple-touch-icon" href="https://www.chatl.ai/favicon.png" />

    <meta property="og:title" content="ChatLearn - AI Chat Platform" />
    <meta property="og:description" content="Your intelligent AI chat platform for seamless conversations" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.chatl.ai/" />
    <meta property="og:image" content="https://www.chatl.ai/og-image.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@chatlearn_ai" />
    <meta name="twitter:title" content="ChatLearn - AI Chat Platform" />
    <meta name="twitter:description" content="Your intelligent AI chat platform for seamless conversations" />
    <meta name="twitter:image" content="https://www.chatl.ai/og-image.png" />

    <!-- HEAD ichida eng yuqoriga qo'ying -->
    <script
      id="Cookiebot"
      src="https://consent.cookiebot.com/uc.js"
      data-cbid="cc9cba1a-5783-4a8d-ba42-f4f1961b15a4"
      data-blockingmode="auto"
      type="text/javascript"
    ></script>

    <script>
      (function ensureCookiebotVisible(){
        const MAX_TRIES = 60;
        const TRY_INTERVAL = 250;
        let tries = 0;

        function moveToBody(el){
          try {
            if (!el) return;
            if (el.parentElement !== document.body) document.body.appendChild(el);
            const style = el.style || {};
            style.setProperty('position', style.position || 'fixed', 'important');
            style.setProperty('left', style.left || '0', 'important');
            style.setProperty('right', style.right || '0', 'important');
            style.setProperty('bottom', style.bottom || '0', 'important');
            style.setProperty('top', style.top || 'auto', 'important');
            style.setProperty('z-index', '2147483647', 'important');
            style.setProperty('pointer-events', 'auto', 'important');
            style.removeProperty('transform');
            style.removeProperty('width');
            style.removeProperty('max-width');
          } catch(e){ /* noop */ }
        }

        function findAndFix(){
          tries++;
          const iframe = document.querySelector('iframe[src*="consent.cookiebot.com"], iframe[id*="CybotCookiebot"]');
          const dialog = document.getElementById('CybotCookiebotDialog') || document.querySelector('.CybotCookiebotDialog') || document.querySelector('[id^="CybotCookiebot"]');
          if (iframe) moveToBody(iframe);
          if (dialog) {
            moveToBody(dialog);
            document.body.classList.add('cookiebot-visible');
          }
          if ((!iframe && !dialog) && tries < MAX_TRIES) {
            setTimeout(findAndFix, TRY_INTERVAL);
            return;
          }

          // observe late DOM changes (Cookiebot may recreate nodes)
          try {
            const mo = new MutationObserver(() => findAndFix());
            mo.observe(document.documentElement || document.body, { childList: true, subtree: true });
            setTimeout(() => mo.disconnect(), 120000);
          } catch(e){}
        }

        // small CSS fallback to force visibility if app styles collide
        const css = `
          iframe[src*="consent.cookiebot.com"],
          iframe[id*="CybotCookiebot"],
          #CybotCookiebotDialog,
          .CybotCookiebotDialog {
            position: fixed !important;
            z-index: 2147483647 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            top: auto !important;
            pointer-events: auto !important;
            width: auto !important;
            max-width: 100% !important;
            transform: none !important;
            visibility: visible !important;
          }
          body.cookiebot-visible { padding-bottom: 200px !important; }
        `;
        const styleEl = document.createElement('style');
        styleEl.setAttribute('data-cookiebot-fix','1');
        styleEl.appendChild(document.createTextNode(css));
        document.head && document.head.appendChild(styleEl);

        // kick it off a bit later so uc.js has time to run
        setTimeout(findAndFix, 300);
      })();
    </script>

    <!-- Google Consent Mode - just analytics & conversion tracking, no Cookiebot -->
    <script>
      window.dataLayer = window.dataLayer || [];
      window.gtag = function () { dataLayer.push(arguments); };

      gtag('consent', 'default', {
        'analytics_storage': 'denied',
        'ad_user_data': 'denied',
        'ad_storage': 'denied',
        'ad_personalization': 'denied',
        'functionality_storage': 'denied',
        'personalization_storage': 'denied',
        'security_storage': 'granted',
        'wait_for_update': 500
      });

      gtag('set', 'ads_data_redaction', true);
      gtag('set', 'url_passthrough', true);
      gtag('set', 'allow_ad_personalization_signals', false);

      gtag('js', new Date());
    </script>
  </head>

  <body>
    <div id="root"></div>

    <!-- React app -->
    <script type="module" src="/src/main.tsx"></script>

    <!-- Tracking scripts (GTM + GA4) -->
    <script>
      (function() {
        var trackingLoaded = false;

        function loadTrackingOnce() {
          if (trackingLoaded) return;
          trackingLoaded = true;

          // Google Tag Manager
          (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),
                dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-NMLGMTL5');

          // Google Analytics / Ads
          var gtagScript = document.createElement('script');
          gtagScript.async = true;
          gtagScript.src = 'https://www.googletagmanager.com/gtag/js?id=AW-16917874636';

          gtagScript.onload = function() {
            window.gtag('config', 'AW-16917874636');
            window.gtag('config', 'G-EDSR82W70J');
          };

          document.head.appendChild(gtagScript);
        }

        function cookiebotHasConsent() {
          try {
            // Cookiebot.consent statistik yoki marketing uchun rozilikni tekshiradi
            return !!(window.Cookiebot && window.Cookiebot.consent && (window.Cookiebot.consent.statistics || window.Cookiebot.consent.marketing));
          } catch (e) {
            return false;
          }
        }

        function waitForConsentThenLoad() {
          if (cookiebotHasConsent()) {
            loadTrackingOnce();
            return;
          }

          var waited = 0;
          var interval = setInterval(function() {
            if (cookiebotHasConsent()) {
              clearInterval(interval);
              loadTrackingOnce();
            } else {
              waited += 500;
              if (waited > 20000) { // 20s timeout
                clearInterval(interval);
              }
            }
          }, 500);
        }

        // DARHOL consent-ni kutib yuklashni boshlaymiz (DOMContentLoaded ga bog'liq emas)
        waitForConsentThenLoad();

        // Qo'shimcha: agar Cookiebot onAccept eventi mavjud bo'lsa, unga ham moslashamiz
        if (window.addEventListener) {
          window.addEventListener('CookiebotOnAccept', function(){
            waitForConsentThenLoad();
          }, false);

          // ba'zi implementatsiyalarda: Cookiebot.consentUpdated kabi event bo'lishi mumkin
          window.addEventListener('CookiebotOnConsentChanged', function(){
            waitForConsentThenLoad();
          }, false);
        }

      })();
    </script>
  </body>
</html>
